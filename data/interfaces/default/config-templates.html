##
## Here defined all templates, required for CONFIG page of the app
##

## ===============================================
## TEMPLATES for TABS
## ===============================================

<%def name="Tab(me, parent=None)">
<%
    cssclass = me.cssclass if me.cssclass else '';
%>
    ## ID for TAB here is required, it is used to choose appropriate tab
    ## usign url in address bar (#bookmarks)
    ## Do not delete ID!
    <div id="${me.id}" class="tab tab-${me.id} ${cssclass}">
        % if me.message:
            <div class="message">
                ${me.message}
            </div>
        % endif

        % for block in me:
            <fieldset class="block ${block.cssclass if block.cssclass else ''}">
                <legend>${block.caption}</legend>
                % for option in block:
                    ${option.render()}
                % endfor    # for option in block
            </fieldset>
        % endfor    # for block in tab
    </div>
</%def>

## ===============================================
## TEMPLATES for common set of OPTIONS
## ===============================================

<%def name="OptionString(me, parent=None)">
<%
    uiname = me.uiId()
    embed_id = uiname + '_embed'
    val = me.value

    size_attr = '' if me.maxlength is None else ' size="%d"' % me.maxlength
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            %if me.writable:
                <input type="text" id="${uiname}" name="${uiname}" value="${val}" ${size_attr} />
            %else:
                <span id="${uiname}" name="${uiname}">${val}</span>
            %endif

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>

    % if 0 < len(me):
        <div id="${embed_id}">
            % for option in me:
                ${option.render(parent=me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionPassword(me, parent=None)">
<%
    uiname = me.uiId()
    embed_id = uiname + '_embed'
    val = me.value

    size_attr = '' if me.maxlength is None else ' size="%d"' % me.maxlength
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            %if me.writable:
                <input type="password" id="${uiname}" name="${uiname}" value="${val}" ${size_attr} />
            %else:
                <span id="${uiname}" name="${uiname}">${'*' * len(val)}</span>
            %endif

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>
    % if 0 < len(me):
        <div id="${embed_id}">
            % for option in me:
                ${option.render(me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionNumber(me, parent=None)">
<%
    uiname = me.uiId()
    embed_id = uiname + '_embed'
    val = me.value

    min_attr = '' if me.minvalue is None else ' min="%d"' % me.minvalue
    max_attr = '' if me.maxvalue is None else ' size="%d"' % me.maxvalue
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            <input type="number" id="${uiname}" name="${uiname}" value="${val}" ${min_attr} ${max_attr} />

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>
    % if 0 < len(me):
        <div id="${embed_id}">
            % for option in me:
                ${option.render(me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionBool(me, parent=None)">
<%
    uiname = me.uiId()
    embed_id = uiname + '_embed'
    val = me.value

    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
    checked_attr = 'checked' if val else ''
%>
    <div class="option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            <input type="checkbox" id="${uiname}" name="${uiname}" value="1" ${checked_attr} />

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>
    % if 0 < len(me):
        <div id="${embed_id}">
            % for option in me:
                ${option.render(me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionSwitch(me, parent=None)">
<%
    uiname = me.uiId()
    embed_id = uiname + '_embed'
    val = me.value

    checked_attr = 'checked' if val else ''
    embed_hidden_style_attr = '' if val else 'style="display:none"'
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            <input class="hp-option-switch" type="checkbox" id="${uiname}" name="${uiname}" data-div="#${embed_id}" value="1" ${checked_attr} />

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>

    % if 0 < len(me):
        <div id="${embed_id}" ${embed_hidden_style_attr}>
            % for option in me:
                ${option.render()}
            % endfor    # for option in block
        </div>
    % endif
</%def>


## ===============================================
## TEMPLATES for
##
## TemplaterExtension
##
## Minimum of python code, just HTML and templates
## ===============================================

<%def name="ApiKeyExtension(me, parent=None)">
<%
    ext = me
    me = parent
    val = me.value

    uiname = me.uiId()
    embed_id = uiname + '_embed'
    button_class = embed_id + '_btn_cls'
%>
<div class="option">
    <label>
        <button type="button" class="${button_class}">${ext.strings['button']}</button>
    </label>
    <div>
        <div class="small caption">${ext.strings['caption']}<strong>${val}</strong></div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $('#${uiname}').click(function(){ $('#${uiname}').select() });

        $(".${button_class}").click(function(){
            $.get('generateAPI', null, { timeout: 5000 })
                .done(
                    function done (data){
                        if (data.error != undefined) {
                            console.error(data.error);
                            alert(data.error);
                            return;
                        }
                        $('#${uiname}').val(data);
                    })
                .fail(function fail(jqXHR, status, error){
                    var msg = null;
                    if (status.message)
                        msg = status.message;
                    else if (status)
                        msg = status;

                    console.error(msg);
                    alert('Error occured:' + msg);
                });
        });
    });
</script>
</%def>


<%def name="LabelExtension(me, parent=None)">
<%
    class_attr = '' if ((not 'class' in me.strings) or (not me.strings['class'])) else ' class="%s"' % me.strings['class']
%>
    <div ${class_attr}>${me.strings['label']}</div>
</%def>
