##
## Here defined all templates, required for CONFIG page of the app
##

## ===============================================
## TEMPLATES for TABS
## ===============================================

<%def name="Tab(me, parent=None)">
<%
    cssclass = me.cssclass if me.cssclass else '';
%>
    ## ID for TAB here is required, it is used to choose appropriate tab
    ## usign url in address bar (#bookmarks)
    ## Do not delete ID!
    <div id="${me.id}" class="tab tab-${me.id} ${cssclass}">
        % if me.message:
            <div class="message">
                ${me.message}
            </div>
        % endif

        % for block in me:
            <fieldset class="block ${block.cssclass if block.cssclass else ''}">
                <legend>${block.caption}</legend>
                % for option in block:
                    ${option.render(parent=me)}
                % endfor    # for option in block
            </fieldset>
        % endfor    # for block in tab

        <input type="button" class="configsubmit" value="${me.savecaption}" data-success="Changes saved successfully" />
    </div>
</%def>

## ===============================================
## TEMPLATES for common set of OPTIONS
## ===============================================

<%def name="OptionString(me, parent=None)">
<%
    uiname = me.uiName()
    embed_id = uiname + '_embed'
    val = me.uiValue()

    size_attr = '' if me.maxlength is None else ' maxlength="%d"' % me.maxlength
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            %if me.readonly:
                <span id="${uiname}" name="${uiname}">${val}</span>
            %else:
                <input type="text" id="${uiname}" name="${uiname}" value="${val}" ${size_attr} />
            %endif

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>

    % if 0 < len(me):
        <div id="${embed_id}" class="embed-option-block">
            % for option in me:
                ${option.render(parent=me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionPassword(me, parent=None)">
<%
    uiname = me.uiName()
    embed_id = uiname + '_embed'
    val = me.uiValue()

    size_attr = '' if me.maxlength is None else ' maxlength="%d"' % me.maxlength
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            %if me.readonly:
                <span id="${uiname}" name="${uiname}">${'*' * len(val)}</span>
            %else:
                <input type="password" id="${uiname}" name="${uiname}" value="${val}" ${size_attr} />
            %endif

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>
    % if 0 < len(me):
        <div id="${embed_id}" class="embed-option-block">
            % for option in me:
                ${option.render(me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionNumber(me, parent=None)">
<%
    uiname = me.uiName()
    embed_id = uiname + '_embed'
    val = me.uiValue()

    min_attr = '' if me.minvalue is None else ' min="%d"' % me.minvalue
    max_attr = '' if me.maxvalue is None else ' size="%d"' % me.maxvalue
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            <input type="number" id="${uiname}" name="${uiname}" value="${val}" ${min_attr} ${max_attr} />

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>
    % if 0 < len(me):
        <div id="${embed_id}" class="embed-option-block">
            % for option in me:
                ${option.render(me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionBool(me, parent=None)">
<%
    uiname = me.uiName()
    checkbox_id = uiname
    hidden_id = uiname + '_hidden_storage'
    embed_id = uiname + '_embed'
    val = me.uiValue()

    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
    checked_attr = 'checked' if val else ''
    hidden_value = '1' if val else '0'
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${checkbox_id}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            <input type="checkbox" class="checkbox-with-hidden" data-hidden-sel="#${hidden_id}" id="${checkbox_id}" ${checked_attr} />
            <input type="hidden" id="${hidden_id}" name="${uiname}" value="${hidden_value}" />

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>
    % if 0 < len(me):
        <div id="${embed_id}" class="embed-option-block">
            % for option in me:
                ${option.render(me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionSwitch(me, parent=None)">
<%
    uiname = me.uiName()
    checkbox_id = uiname
    hidden_id = uiname + '_hidden_storage'
    embed_id = uiname + '_embed'
    val = me.uiValue()

    checked_attr = 'checked' if val else ''
    embed_hidden_style_attr = '' if val else 'style="display:none"'
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
    hidden_value = '1' if val else '0'
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${checkbox_id}">
                ${me.label}
            </label>
        %endif

        <div class="input-wrapper">
            <input class="hp-option-switch checkbox-with-hidden" type="checkbox" id="${checkbox_id}" data-hidden-sel="#${hidden_id}" data-embed-div="#${embed_id}" ${checked_attr} />
            <input type="hidden" id="${hidden_id}" name="${uiname}" value="${hidden_value}" />

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>

    % if 0 < len(me):
        <div id="${embed_id}" class="embed-option-block" ${embed_hidden_style_attr}>
            % for option in me:
                ${option.render()}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionDropdown(me, parent=None)">
<%
    uiname = me.uiName()
    val = me.uiValue()

    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div ${tooltip_attr} class="input-wrapper">
            %if me.readonly:
                ## TODO: try to use disabled!
                <span id="${uiname}" name="${uiname}">${val}</span>
            %else:
                <select id="${uiname}" name="${uiname}" size="1">
                % for i in me.items:
                    <option value="${i.value}" ${"selected" if i.value==val else ""}>${i.label}</option>
                % endfor
                </select>
            %endif

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>

    % if 0 < len(me):
        <div class="embed-option-block">
            % for option in me:
                ${option.render(parent=me)}
            % endfor    # for option in block
        </div>
    % endif
</%def>


<%def name="OptionDropdownSelector(me, parent=None)">
<%
    uiname = me.uiName()
    val = me.uiValue()

    cssclass_items_common = 'hp-option-selector-items-' + uiname
    cssclass_item_prefix = '-item-'

    raw_hidden_style_attr = 'style="display:none"'
    tooltip_attr = '' if me.tooltip is None else ' title="%s"' % me.tooltip
%>
    <div class="row option">
        %if me.label is not None:
            <label ${tooltip_attr} for="${uiname}">
                ${me.label}
            </label>
        %endif

        <div ${tooltip_attr} class="input-wrapper">
            %if me.readonly:
                ## try to use disabled!
                <span id="${uiname}" name="${uiname}">${val}</span>
            %else:
                <select class="hp-option-selector" id="${uiname}" name="${uiname}" size="1" data-linked-div-sel=".${cssclass_items_common}">
                % for i in me.items:
                    <option value="${i.value}" ${"selected" if i.value==val else ""} data-linked-div-sel=".${cssclass_items_common}.${cssclass_item_prefix + str(i.uniq)}">${i.label}</option>
                % endfor
                </select>
            %endif

            %if me.caption is not None:
                <div class="small caption">${me.caption}</div>
            %endif
        </div>
    </div>

    <!-- 1. select-embed items -->
    % if 0 < len(me):
        <div class="embed-option-block">
            % for option in me:
                ${option.render(parent=me)}
            % endfor    # for option in block
        </div>
    % endif

    <!-- 2. select's OPTION-child options -->
    % for i in me.items:
        % if len(i.options)>0:
            <div ${"" if i.value==val else raw_hidden_style_attr} class="${cssclass_items_common + ' ' + cssclass_item_prefix + str(i.uniq)}">
            % for option in i.options:
                ${option.render(parent=me)}
            % endfor
            </div>
        % endif
    % endfor
</%def>

## ===============================================
## PLACEHOLDERS and STATIC templates
## ===============================================

<%def name="LabelExtension(me, parent=None)">
<%
    cssclasses = list(me.cssclasses)
    if not me.fullwidth:
        cssclasses.append('input-wrapper')

    class_attr = '' if not cssclasses else 'class="' + ' '.join(cssclasses) + '"'
%>
    ## TODO : define name of class for root divs
    <div class="row">
        % if not me.fullwidth:
            <label>&nbsp;</label>
        % endif
        <div ${class_attr}>${me.label}</div>
    </div>
</%def>


## ===============================================
## TEMPLATES for
##
## TemplaterExtension
##
## Minimum of python code, just HTML and templates
##
## USE THESE AS RARE AS POSSIBLE
##
## ===============================================

<%def name="ApiKeyExtension(me, parent=None)">
<%
    ext = me
    me = parent
    val = me.uiValue()

    uiname = me.uiName()
%>
<div class="row option-extension">
    <label>
        <button type="button" data-input-sel=".option input[name=${uiname}]" class="API_KEY">${ext.strings['button']}</button>
    </label>
    <div>
        <div class="small caption">${ext.strings['caption']}<strong>${val}</strong></div>
    </div>
</div>
</%def>
