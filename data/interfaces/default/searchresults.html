<%inherit file="base.html" />

<%def name="body()">
	<div class="table_wrapper">
	<div id="paddingheader">
		<h1 class="clearfix"><img src="interfaces/default/images/icon_search.png" alt="Search results"/>Search Result</h1>
	</div>
	<table class="display" id="searchresults_table">
		<thead>
			<tr>
				<th id="albumart"></th>
				%if type == 'album':
					<th id="albumname">Album Name</th>
				%endif
				<th id="artistname">Artist Name</th>
                %if type == 'album':
                    <th id="reldate">Date</th>
                %endif
				<th id="score">Score</th>
				<th id="add"></th>
			</tr>
		</thead>
		<tbody>
        %if searchresults:
            %for result in searchresults:
            <%
                if result['score'] == 100:
                    grade = 'A'
                else:
                    grade = 'Z'

                # TODO: HTMLify this bit
                if type == 'album':
                    title = result['title']
                    if result['disambiguation']:
                        title += ' (' + result['disambiguation'] + ')'
                    albuminfo = 'Country: ' + result['country'] + ', Format: ' + result['formats']
                    albuminfo = albuminfo.replace('"', "&quot;")
            %>
                <tr class="grade${grade}">
                    %if type == 'album':
                        <td id="albumart"><div id="artistImg"><img title="${result['albumid']}" class="albumArt" height="50" width="50"></div></td>
                    %else:
                        <td id="albumart"><div id="artistImg"><img title="${result['id']}" class="albumArt" height="50" width="50"></div></td>
                    %endif
                    %if type == 'album':
                        <td id="albumname"><a href="${result['albumurl']} "title="${albuminfo}" >${title}</a></td>
                    %endif
                    <td id="artistname"><a href="${result['url']}" title="${result['uniquename']}">${result['uniquename']}</a></td>
                    %if type == 'album':
                        <td id="reldate">${result['date']}</td>
                    %endif
                    <td id="score"><div class="bar"><div class="score" style="width: ${result['score']}px">${result['score']}</div></div></td>
                    %if type == 'album':
                        <td id="add"><a href="addReleaseById?rid=${result['albumid']}"><span class="ui-icon ui-icon-plus"></span> Add this album</a></td>
                    %else:
                        <td id="add"><a href="addArtist?artistid=${result['id']}"><span class="ui-icon ui-icon-plus"></span> Add this artist</a></td>
                    %endif
                </tr>
            %endfor
        %endif
		</tbody>
	</table>
	</div>
</%def>

<%def name="headIncludes()">
	<link rel="stylesheet" href="interfaces/default/css/data_table.css">
</%def>

<%def name="javascriptIncludes()">

	<script src="js/libs/jquery.dataTables.min.js"></script>

	<script>
	function getArt() {
		$("table#searchresults_table tr td#albumart img").each(function(){
			var id = $(this).attr('title');
			var image = $(this);
			if ( !image.hasClass('done') ) {
				image.addClass('done');
				getImageLinks(image,id,"${type}");
			}
		});
	}
	function initThisPage() {
		getArt();
        $('#searchresults_table').dataTable(
			{
				"bDestroy": true,
				"aoColumnDefs": [
			          { 'bSortable': false, 'aTargets': [ 0 ] }
				],
				"oLanguage": {
					"sLengthMenu":"Show _MENU_ results per page",
					"sEmptyTable": "No results",
					"sInfo":"Showing _START_ to _END_ of _TOTAL_ results",
					"sInfoEmpty":"Showing 0 to 0 of 0 results",
					"sInfoFiltered":"(filtered from _MAX_ total results)",
					"sSearch" : ""},
				"iDisplayLength": 25,
				"sPaginationType": "full_numbers",
				"aaSorting": []
			});
			resetFilters("album");
	}
	$(document).ready(function(){
			initThisPage();
	});
	$(window).load(function(){
		initFancybox();
	});
	</script>
</%def>
